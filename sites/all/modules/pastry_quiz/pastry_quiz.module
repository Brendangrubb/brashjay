<?php

function pastry_quiz_menu() {
    $items['quiz'] = array(
        'title' => 'What should I eat!?',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('gluten_quiz_form'),
        'access callback' => TRUE,
        'type' => MENU_NORMAL_ITEM,
    );

    $items['quiz_question_1'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('gluten_free_quiz_form'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_question_2'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('drupal_get_form'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_question_3'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('gluten_quiz_form'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_results'] = array(
        'title' => 'Quiz Results!',
        'page callback' => 'quiz_success',
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    return $items;
}

function gluten_quiz_form() {
  $form['gluten'] = array(
      '#title' => 'Are you gluten intolerant?',
      '#type' => 'radios',
      '#options' => array(
          1 => t('Yes'),
          0 => t('No'),
      ),
      '#required' => TRUE,
  );

  $form['submit'] = array(
          '#type' => 'submit',
          '#value' => 'Submit',
  );

  return $form;
}

function gluten_free_quiz_form() {
    $form['gf'] = array(
        '#title' => 'Gluten Free',
        '#type' => 'select',
        '#description' => t('So you\'re gluten free? No problem! We have a number of options for you. Do you prefer sweet or savory?'),
        '#options' => array(
            t('Select One'),
            t('1'),
            t('2'),
            t('3'),
            t('4'),
            t('5'),
        ),
        '#required' => TRUE,
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'Submit',
    );

    return $form;
}

function gluten_quiz_form_submit($form, &$form_state) {
  $gluten = $form_state['values']['gluten'];
  $_SESSION['gluten'] = $gluten;

  if ($gluten) {
    $form_state['redirect'] = 'gluten_free_quiz_form';
  } else {
    $form_state['redirect'] = 'gluten_quiz_form';
  }
}

function gluten_quiz_success() {
  $gluten = $_SESSION['values']['gluten'];

  if ($gluten) {
    return '<p>Awesome! We have plenty of pastries for you. Our croissants are great!</p>';
  } else {
    return "<p>No problem! We have many gluten-free items available for you.</p>";
  }
}

function start_form_submit($form, &$form_state) {
  $form_state['redirect'] = 'quiz_question_1';
}
